name: CI-docs

on:
  pull_request:
    types:
      - opened
      - reopened
      - synchronize

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # CLone repo at current branch
      - name: Clone repo
        uses: actions/checkout@v4
        with:
          persist-credentials: false
          ref: ${{ github.head_ref }}
          token: ${{ secrets.GIT_TOKEN }}

      # Setup node environment
      - name: Setup Node.js environment
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      # Install node modules
      - name: Install node modules
        run: |
          yarn install

      # Clone template
      - name: Clone docdash template
        uses: actions/checkout@v4
        with:
          repository: clenemt/docdash
          path: ./template/docdash/

      # Install docdash node modules
      - name: Install node modules
        working-directory: ./template/docdash/
        run: |
          yarn install

      # Generate docs
      - name: Generate docs
        run: |
          yarn generate-docs

      # Commit docs on current branch (update pull request)
      - name: Commit docs
        uses: actions-js/push@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          message: "Update docs"
          branch: ${{ github.head_ref }}
          empty: true
