name: CI-docs

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the master branch
# on:
#   push:
#     branches: [fix-docs-workflow] #TODO restore master

on:
  pull_request:
    types:
      - opened
      - reopened
      - synchronize

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # First job, build package
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - name: Clone repo
        uses: actions/checkout@v2
        with:
          persist-credentials: false
          ref: ${{ github.ref }}
          token: ${{ secrets.GIT_TOKEN }}

      # Setup node environment
      - name: Setup Node.js environment
        uses: actions/setup-node@v2
        with:
          node-version: "14"

      # Install node modules
      - name: Install node modules
        run: |
          yarn install

      # Clone template
      - name: Clone docdash template
        uses: actions/checkout@v2
        with:
          repository: clenemt/docdash
          path: ./template/docdash/

      # Generate docs
      - name: Generate docs
        run: |
          yarn generate-docs

      # Print & pull
      - name: Print & pull 
        run: / 
          echo head ref ${{ github.head_ref }}
          git pull origin ${{ github.head_ref }}

      # Commit Package and Docs
      - name: Commit docs
        uses: actions-js/push@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          message: "Update docs"
          branch: ${{ github.head_ref }}
          empty: true 
      
      # Update PR
      # - name: Update Pull Request 
      #   uses: gr2m/create-or-update-pull-request-action@v1
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #   with: 

