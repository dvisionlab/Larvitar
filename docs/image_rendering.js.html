<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>image_rendering.js - Larvitar</title>

    <meta name="description" content="Dicom Image Toolkit for CornestoneJS" />

    <meta name="keywords" content="imaging, dataviz, medical, cornerstone" />
    <meta name="keyword" content="imaging, dataviz, medical, cornerstone" />

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css" />
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css" />
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <input type="checkbox" id="nav-trigger" class="nav-trigger" />
    <label for="nav-trigger" class="navicon-button x">
      <div class="navicon"></div>
    </label>

    <label for="nav-trigger" class="overlay"></label>

    <nav>
      <input type="text" id="nav-search" placeholder="Search" />

      <h2><a href="index.html">Home</a></h2>
      <h2>
        <a
          href="https://github.com/dvisionlab/Larvitar"
          target="_blank"
          class="menu-item"
          id="repository"
          >Github repo</a
        >
      </h2>
      <h3>Classes</h3>
      <ul>
        <li>
          <a href="module-imaging_store.html">imaging/store</a>
          <ul class="methods">
            <li data-type="method" style="display: none;">
              <a href="module-imaging_store.html#~disableVuex">disableVuex</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_store.html#~enableVuex">enableVuex</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_store.html#~get">get</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_store.html#~set">set</a>
            </li>
          </ul>
        </li>
        <li>
          <a href="Tools.Annotation.ContoursTool.html"
            >Tools.Annotation.ContoursTool</a
          >
        </li>
        <li>
          <a href="Tools.Annotation.DiameterTool.html"
            >Tools.Annotation.DiameterTool</a
          >
        </li>
        <li>
          <a href="Tools.Annotation.SeedsTool.html"
            >Tools.Annotation.SeedsTool</a
          >
        </li>
        <li><a href="Tools.Brush.BrushTool.html">Tools.Brush.BrushTool</a></li>
      </ul>
      <h3>Modules</h3>
      <ul>
        <li>
          <a href="module-imaging_contours.html">imaging/contours</a>
          <ul class="methods">
            <li data-type="method" style="display: none;">
              <a href="module-imaging_contours.html#extractSlicePoints"
                >extractSlicePoints</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_contours.html#populateContoursObject"
                >populateContoursObject</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_contours.html#~parseContours"
                >parseContours</a
              >
            </li>
          </ul>
        </li>
        <li>
          <a href="module-imaging_io.html">imaging/io</a>
          <ul class="methods">
            <li data-type="method" style="display: none;">
              <a href="module-imaging_io.html#~buildData">buildData</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_io.html#~buildHeader">buildHeader</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_io.html#~cacheAndSaveSerie"
                >cacheAndSaveSerie</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_io.html#~importNRRDImage"
                >importNRRDImage</a
              >
            </li>
          </ul>
        </li>
        <li>
          <a href="module-imaging_layers.html">imaging/layers</a>
          <ul class="methods">
            <li data-type="method" style="display: none;">
              <a href="module-imaging_layers.html#changeOpacityLayer"
                >changeOpacityLayer</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_layers.html#getMainLayer">getMainLayer</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_layers.html#loadImageLayers"
                >loadImageLayers</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_layers.html#updateImageLayer"
                >updateImageLayer</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_layers.html#~buildLayers">buildLayers</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_layers.html#~loadLayers">loadLayers</a>
            </li>
          </ul>
        </li>
        <li>
          <a href="module-imaging_loading.html">imaging/loading</a>
          <ul class="methods">
            <li data-type="method" style="display: none;">
              <a href="module-imaging_loading.html#initializeFileImageLoader"
                >initializeFileImageLoader</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_loading.html#initializeImageLoader"
                >initializeImageLoader</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_loading.html#initializeWebImageLoader"
                >initializeWebImageLoader</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_loading.html#registerNRRDImageLoader"
                >registerNRRDImageLoader</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_loading.html#registerResliceLoader"
                >registerResliceLoader</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_loading.html#updateLoadedStack"
                >updateLoadedStack</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_loading.html#~isNewInstance"
                >isNewInstance</a
              >
            </li>
          </ul>
        </li>
        <li>
          <a href="module-imaging_parsing.html">imaging/parsing</a>
          <ul class="methods">
            <li data-type="method" style="display: none;">
              <a href="module-imaging_parsing.html#readFiles">readFiles</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_parsing.html#resetImageParsing"
                >resetImageParsing</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_parsing.html#~clearFileSystem"
                >clearFileSystem</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_parsing.html#~dumpFile">dumpFile</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_parsing.html#~dumpFiles">dumpFiles</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_parsing.html#~errorHandler"
                >errorHandler</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_parsing.html#~parseNextFile"
                >parseNextFile</a
              >
            </li>
          </ul>
        </li>
        <li>
          <a href="module-imaging_rendering.html">imaging/rendering</a>
          <ul class="methods">
            <li data-type="method" style="display: none;">
              <a href="module-imaging_rendering.html#.HSVToRGB">HSVToRGB</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_rendering.html#addColorMap"
                >addColorMap</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_rendering.html#applyColorMap"
                >applyColorMap</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_rendering.html#clearImageCache"
                >clearImageCache</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_rendering.html#enableMouseHandlers"
                >enableMouseHandlers</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_rendering.html#fillPixelData"
                >fillPixelData</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_rendering.html#getColormapsList"
                >getColormapsList</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_rendering.html#loadFileImage"
                >loadFileImage</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_rendering.html#loadImage">loadImage</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_rendering.html#loadWebImage"
                >loadWebImage</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_rendering.html#reloadImage"
                >reloadImage</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_rendering.html#resetViewports"
                >resetViewports</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_rendering.html#storeViewportData"
                >storeViewportData</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_rendering.html#updateImage"
                >updateImage</a
              >
            </li>
          </ul>
        </li>
        <li></li>
        <li>
          <a href="module-imaging_store.html">imaging/store</a>
          <ul class="methods">
            <li data-type="method" style="display: none;">
              <a href="module-imaging_store.html#~disableVuex">disableVuex</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_store.html#~enableVuex">enableVuex</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_store.html#~get">get</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_store.html#~set">set</a>
            </li>
          </ul>
        </li>
        <li>
          <a href="module-imaging_tools.html">imaging/tools</a>
          <ul class="methods">
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~addContoursTool"
                >addContoursTool</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~addDefaultTools"
                >addDefaultTools</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~addDiameterTool"
                >addDiameterTool</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~addMaskEditingTool"
                >addMaskEditingTool</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~addSeedsTool">addSeedsTool</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~addStackStateToElement"
                >addStackStateToElement</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~addToolStateSingleSlice"
                >addToolStateSingleSlice</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~clearCornerstoneElements"
                >clearCornerstoneElements</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~clearMeasurements"
                >clearMeasurements</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~clearToolStateByName"
                >clearToolStateByName</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a
                href="module-imaging_tools.html#~configureCornerstoneToolsSettings"
                >configureCornerstoneToolsSettings</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~csToolsCreateStack"
                >csToolsCreateStack</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~getCurrentMaskData"
                >getCurrentMaskData</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~getToolState">getToolState</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~initializeCSTools"
                >initializeCSTools</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~isToolMissing"
                >isToolMissing</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~setSegmentationConfig"
                >setSegmentationConfig</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~setToolActive"
                >setToolActive</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~setToolActive"
                >setToolActive</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~setToolEnabled"
                >setToolEnabled</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~setToolPassive"
                >setToolPassive</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~syncToolStack"
                >syncToolStack</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~updateDiameterTool"
                >updateDiameterTool</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_tools.html#~updateStackToolState"
                >updateStackToolState</a
              >
            </li>
          </ul>
        </li>
        <li>
          <a href="module-imaging_utils.html">imaging/utils</a>
          <ul class="methods">
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#formatDate">formatDate</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#formatDateTime"
                >formatDateTime</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#getCmprMetadata"
                >getCmprMetadata</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#getDICOMTag">getDICOMTag</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#getDICOMTagCode"
                >getDICOMTagCode</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#getDistanceBetweenSlices"
                >getDistanceBetweenSlices</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#getMaxPixelValue"
                >getMaxPixelValue</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#getMeanValue">getMeanValue</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#getMinPixelValue"
                >getMinPixelValue</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#getNormalOrientation"
                >getNormalOrientation</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#getPixelRepresentation"
                >getPixelRepresentation</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#getPixelTypedArray"
                >getPixelTypedArray</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#getPixelTypedArray"
                >getPixelTypedArray</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#getReslicedIOP"
                >getReslicedIOP</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#getReslicedIPP"
                >getReslicedIPP</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#getReslicedMetadata"
                >getReslicedMetadata</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#getReslicedPixeldata"
                >getReslicedPixeldata</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#getReslicedSliceLocation"
                >getReslicedSliceLocation</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#getTagValue">getTagValue</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#getTypedArray"
                >getTypedArray</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#isNegativeSign"
                >isNegativeSign</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#parseImageId">parseImageId</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#permuteSignedArrays"
                >permuteSignedArrays</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#permuteValues"
                >permuteValues</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#rand">rand</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#randomId">randomId</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#remapVoxel">remapVoxel</a>
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#sortStackCallback"
                >sortStackCallback</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-imaging_utils.html#spacingArray">spacingArray</a>
            </li>
          </ul>
        </li>
        <li>
          <a href="module-loaders_commonLoader.html">loaders/commonLoader</a>
          <ul class="methods">
            <li data-type="method" style="display: none;">
              <a href="module-loaders_commonLoader.html#getCustomImageId"
                >getCustomImageId</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_commonLoader.html#getImageFrame"
                >getImageFrame</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_commonLoader.html#getLarvitarManager"
                >getLarvitarManager</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_commonLoader.html#getSerieDimensions"
                >getSerieDimensions</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_commonLoader.html#getSeriesData"
                >getSeriesData</a
              >
            </li>
          </ul>
        </li>
        <li>
          <a href="module-loaders_dicomLoader.html">loaders/dicomLoader</a>
          <ul class="methods">
            <li data-type="method" style="display: none;">
              <a href="module-loaders_dicomLoader.html#getSeriesData"
                >getSeriesData</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_dicomLoader.html#initializeMainViewport"
                >initializeMainViewport</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a
                href="module-loaders_dicomLoader.html#initializeReslicedViewport"
                >initializeReslicedViewport</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_dicomLoader.html#populateDicomManager"
                >populateDicomManager</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_dicomLoader.html#populateDicomManager"
                >populateDicomManager</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a
                href="module-loaders_dicomLoader.html#removeSeriesFromDicomManager"
                >removeSeriesFromDicomManager</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_dicomLoader.html#resetDicomManager"
                >resetDicomManager</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_dicomLoader.html#resetImageLoader"
                >resetImageLoader</a
              >
            </li>
          </ul>
        </li>
        <li>
          <a href="module-loaders_nrrdLoader.html">loaders/nrrdLoader</a>
          <ul class="methods">
            <li data-type="method" style="display: none;">
              <a href="module-loaders_nrrdLoader.html#createCustomImage"
                >createCustomImage</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_nrrdLoader.html#getImageIdFromSlice"
                >getImageIdFromSlice</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_nrrdLoader.html#getNrrdImageId"
                >getNrrdImageId</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_nrrdLoader.html#getSerieDimensions"
                >getSerieDimensions</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_nrrdLoader.html#getSeriesData"
                >getSeriesData</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_nrrdLoader.html#getSliceNumberFromImageId"
                >getSliceNumberFromImageId</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_nrrdLoader.html#initializeCmprViewport"
                >initializeCmprViewport</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_nrrdLoader.html#initializeMainViewport"
                >initializeMainViewport</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a
                href="module-loaders_nrrdLoader.html#initializeReslicedViewport"
                >initializeReslicedViewport</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_nrrdLoader.html#loadImageWithOrientation"
                >loadImageWithOrientation</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_nrrdLoader.html#loadNrrdImage"
                >loadNrrdImage</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_nrrdLoader.html#populateNrrdManager"
                >populateNrrdManager</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a
                href="module-loaders_nrrdLoader.html#removeSeriesFromNrrdManager"
                >removeSeriesFromNrrdManager</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_nrrdLoader.html#resetNrrdLoader"
                >resetNrrdLoader</a
              >
            </li>
          </ul>
        </li>
        <li>
          <a href="module-loaders_resliceLoader.html">loaders/resliceLoader</a>
          <ul class="methods">
            <li data-type="method" style="display: none;">
              <a href="module-loaders_resliceLoader.html#createCustomImage"
                >createCustomImage</a
              >
            </li>
            <li data-type="method" style="display: none;">
              <a href="module-loaders_resliceLoader.html#loadReslicedImage"
                >loadReslicedImage</a
              >
            </li>
          </ul>
        </li>
        <li><a href="module-tools_default.html">tools/default</a></li>
      </ul>
      <h3>Events</h3>
      <ul>
        <li>
          <a href="ContoursTool.html#event:_drawingDoubleTapClickCallback"
            >ContoursTool#_drawingDoubleTapClickCallback</a
          >
        </li>
        <li>
          <a href="ContoursTool.html#event:_drawingMouseDoubleClickCallback"
            >ContoursTool#_drawingMouseDoubleClickCallback</a
          >
        </li>
        <li>
          <a href="ContoursTool.html#event:_drawingMouseDownCallback"
            >ContoursTool#_drawingMouseDownCallback</a
          >
        </li>
        <li>
          <a href="ContoursTool.html#event:_drawingMouseDragCallback"
            >ContoursTool#_drawingMouseDragCallback</a
          >
        </li>
        <li>
          <a href="ContoursTool.html#event:_drawingMouseMoveCallback"
            >ContoursTool#_drawingMouseMoveCallback</a
          >
        </li>
        <li>
          <a href="ContoursTool.html#event:_drawingMouseUpCallback"
            >ContoursTool#_drawingMouseUpCallback</a
          >
        </li>
        <li>
          <a href="ContoursTool.html#event:_drawingTouchDragCallback"
            >ContoursTool#_drawingTouchDragCallback</a
          >
        </li>
        <li>
          <a href="ContoursTool.html#event:_drawingTouchStartCallback"
            >ContoursTool#_drawingTouchStartCallback</a
          >
        </li>
        <li>
          <a href="ContoursTool.html#event:_editMouseDragCallback"
            >ContoursTool#_editMouseDragCallback</a
          >
        </li>
        <li>
          <a href="ContoursTool.html#event:_editTouchDragCallback"
            >ContoursTool#_editTouchDragCallback</a
          >
        </li>
      </ul>
      <h3>Global</h3>
      <ul>
        <li><a href="global.html#addDefaultTools">addDefaultTools</a></li>
        <li><a href="global.html#addTool">addTool</a></li>
        <li>
          <a href="global.html#configureCornerstoneToolsSettings"
            >configureCornerstoneToolsSettings</a
          >
        </li>
        <li><a href="global.html#csToolsCreateStack">csToolsCreateStack</a></li>
        <li><a href="global.html#extractToolInfo">extractToolInfo</a></li>
        <li><a href="global.html#generateCSV">generateCSV</a></li>
        <li><a href="global.html#initializeCSTools">initializeCSTools</a></li>
        <li><a href="global.html#isToolMissing">isToolMissing</a></li>
        <li><a href="global.html#restoreToolState">restoreToolState</a></li>
        <li><a href="global.html#saveToolState">saveToolState</a></li>
        <li><a href="global.html#setToolActive">setToolActive</a></li>
        <li><a href="global.html#setToolEnabled">setToolEnabled</a></li>
        <li><a href="global.html#setToolPassive">setToolPassive</a></li>
      </ul>
    </nav>

    <div id="main">
      <h1 class="page-title">image_rendering.js</h1>

      <section>
        <article>
          <pre
            class="prettyprint source linenums"
          ><code>/** @module imaging/rendering
 *  @desc  This file provides functionalities for
 *         rendering images in html canvas using cornerstone
 *  @todo Document
 */

// external libraries
import cornerstone from "cornerstone-core";
import { each } from "lodash";

// internal libraries
import { csToolsCreateStack } from "./image_tools";
import { default as larvitar_store } from "./image_store";
let store = larvitar_store.state ? larvitar_store : new larvitar_store();

/*
 * This module provides the following functions to be exported:
 * clearImageCache()
 * loadImage(series, elementId)
 * loadFileImage(file, elementId)
 * loadWebImage(url, elementId)
 * updateImage(series, elementId, imageIndex)
 * resetViewports([elementIds])
 */

/**
 * Purge the cornestone internal cache
 * @instance
 * @function clearImageCache
 */
export const clearImageCache = function () {
  cornerstone.imageCache.purgeCache();
};

/**
 * Load an image (png or jpg) from File on a html div using cornerstone
 * @instance
 * @function loadFileImage
 * @param {Object} file - The image File object
 * @param {String} elementId - The html div id used for rendering
 */
export const loadFileImage = function(file, elementId) {
  let element = document.getElementById(elementId);
  if (!element) {
    console.error("invalid html element: " + elementId);
    return;
  }

  if (cornerstone.getEnabledElements().length == 0) {
    cornerstone.enable(element);
  }

  const imageId = cornerstoneFileImageLoader.fileManager.add(file);
  cornerstone.loadImage(imageId).then(function(image) {
    cornerstone.displayImage(element, image);
    cornerstone.fitToWindow(element);
  });
};

/**
 * Load an image (png or jpg) from web url on a html div using cornerstone
 * @instance
 * @function loadWebImage
 * @param {String} url - The image data url
 * @param {String} elementId - The html div id used for rendering
 */
export const loadWebImage = function(url, elementId) {
  let element = document.getElementById(elementId);
  if (!element) {
    console.error("invalid html element: " + elementId);
    return;
  }

  cornerstone.enable(element);
  cornerstone.loadImage(url).then(function(image) {
    cornerstone.displayImage(element, image);
  });
};

/**
 * Reload an image on a html div using cornerstone
 * @instance
 * @function reloadImage
 * @param {Object} series - The original series data object
 * @param {String} elementId - The html div id used for rendering
 */
export const reloadImage = function (series, elementId) {
  let element = document.getElementById(elementId);
  if (!element) {
    console.error("invalid html element: " + elementId);
    return;
  }
  let viewer = store.get("viewer");
  cornerstone.enable(element);
  let sliceId = store.get(viewer, elementId, "sliceId");
  let currentImageId = series.imageIds[sliceId];

  each(series.imageIds, function (imageId) {
    cornerstone.loadAndCacheImage(imageId).then(function (image) {
      if (currentImageId == imageId) {
        cornerstone.displayImage(element, image);
        let viewport = cornerstone.getViewport(element);
        viewport.voi.windowWidth = store.get(
          viewer,
          elementId,
          "viewport",
          "voi",
          "windowWidth"
        );
        viewport.voi.windowCenter = store.get(
          viewer,
          elementId,
          "viewport",
          "voi",
          "windowCenter"
        );
        csToolsCreateStack(element);
        enableMouseHandlers(elementId, element);
        cornerstone.fitToWindow(element);
        store.set(viewer, "loadingStatus", [elementId, true]);
      }
    });
  });
};

/**
 * Load an cache image and render it in a html div using cornerstone
 * @instance
 * @function loadImage
 * @param {Object} series - The original series data object
 * @param {String} elementId - The html div id used for rendering
 */
export const loadImage = function (series, elementId, defaultImageIndex) {
  let element = document.getElementById(elementId);
  if (!element) {
    console.error("invalid html element: " + elementId);
    return;
  }
  cornerstone.enable(element);

  let numberOfSlices = series.imageIds.length;
  let imageIndex =
    defaultImageIndex &amp;&amp; defaultImageIndex &lt;= series.imageIds.length
      ? defaultImageIndex
      : Math.floor(series.imageIds.length / 2);
  let currentImageId = series.imageIds[imageIndex - 1];
  let rows = series.instances[series.imageIds[0]].metadata["x00280010"];
  let cols = series.instances[series.imageIds[0]].metadata["x00280011"];
  let thickness = series.instances[series.imageIds[0]].metadata["x00180050"];
  let spacing_x = series.instances[series.imageIds[0]].metadata["x00280030"]
    ? series.instances[series.imageIds[0]].metadata["x00280030"][0]
    : null;
  let spacing_y = series.instances[series.imageIds[0]].metadata["x00280030"]
    ? series.instances[series.imageIds[0]].metadata["x00280030"][1]
    : null;
  let wc =
    series.instances[series.imageIds[0]].metadata["x00281050"][0] ||
    series.instances[series.imageIds[0]].metadata["x00281050"];
  let wl =
    series.instances[series.imageIds[0]].metadata["x00281051"][0] ||
    series.instances[series.imageIds[0]].metadata["x00281051"];

  if (rows == null || cols == null) {
    console.error("invalid image metadata");
    store.set(null, "errorLog", "Invalid Image Metadata");
    return;
  } else {
    store.set(null, "errorLog", "");
  }

  each(series.imageIds, function (imageId) {
    cornerstone.loadAndCacheImage(imageId).then(function (image) {
      // HACK to force render re-evaluation (otherwise it remains stuck on GrayScaleRenderer)
      image.render = null;

      if (currentImageId == imageId) {
        cornerstone.displayImage(element, image);
        let viewport = cornerstone.getViewport(element);
        viewport.voi.windowWidth = wl;
        viewport.voi.windowCenter = wc;
        cornerstone.fitToWindow(element);

        csToolsCreateStack(element);
        enableMouseHandlers(elementId, element);

        storeViewportData(
          image,
          elementId,
          imageIndex,
          numberOfSlices,
          rows,
          cols,
          spacing_x,
          spacing_y,
          thickness,
          viewport
        );
      }
    });
  });
};

/**
 * Update the cornerstone image with new imageIndex
 * @instance
 * @function updateImage
 * @param {Object} series - The original series data object
 * @param {String} elementId - The html div id used for rendering
 * @param {Number} imageIndex - The index of the image to be rendered
 */
export const updateImage = function (series, element, imageIndex) {
  if (!element) {
    return;
  }
  cornerstone.loadImage(series.imageIds[imageIndex - 1]).then(function (image) {
    cornerstone.displayImage(element, image);
  });
};

/**
 * Reset viewport values (scale, translation and wwwc)
 * @instance
 * @function resetViewports
 * @param {Array} elementIds - The array of hmtl div ids
 */
export const resetViewports = function (elementIds) {
  each(elementIds, function (elementId) {
    let element = document.getElementById(elementId);
    if (!element) {
      console.error("invalid html element: " + elementId);
      return;
    }
    let viewer = store.get("viewer");
    let viewport = cornerstone.getViewport(element);
    viewport.scale = store.get(viewer, elementId, "default", "scale");
    viewport.rotation = store.get(viewer, elementId, "default", "rotation");
    viewport.translation.x = store.get(
      viewer,
      elementId,
      "default",
      "translation",
      "x"
    );
    viewport.translation.y = store.get(
      viewer,
      elementId,
      "default",
      "translation",
      "y"
    );
    viewport.voi.windowWidth = store.get(
      viewer,
      elementId,
      "default",
      "voi",
      "windowWidth"
    );
    viewport.voi.windowCenter = store.get(
      viewer,
      elementId,
      "default",
      "voi",
      "windowCenter"
    );

    cornerstone.setViewport(element, viewport);
    cornerstone.fitToWindow(element);
    cornerstone.updateImage(element);

    store.set(viewer, "scale", [elementId, viewport.scale]);
    store.set(viewer, "rotation", [elementId, viewport.rotation]);
    store.set(viewer, "translation", [
      elementId,
      viewport.translation.x,
      viewport.translation.y
    ]);
    store.set(viewer, "contrast", [
      elementId,
      viewport.voi.windowWidth,
      viewport.voi.windowCenter
    ]);
  });
};

/**
 * Add event handlers to mouse move
 * @instance
 * @function enableMouseHandlers
 * @param {String} elementId - The html div id used for rendering
 */
export const enableMouseHandlers = function (elementId) {
  let element = document.getElementById(elementId);
  if (!element) {
    console.error("invalid html element: " + elementId);
    return;
  }
  element.removeEventListener("mousedown", mouseDownHandler);
  function mouseDownHandler(e) {
    const mouseButton = e.which;
    // get action from global store
    if (mouseButton != 1 || e.target.localName != "canvas") {
      // console.warn("not left mouse or wrong target, return");
      return;
    }
    function mouseMoveHandler() {
      let viewport = cornerstone.getViewport(element);
      let viewportNames = store.get("viewports");
      let viewer = store.get("viewer");
      each(viewportNames, function (viewportName) {
        // sync ww and wc values in store
        store.set(viewer, "contrast", [
          viewportName,
          viewport.voi.windowWidth,
          viewport.voi.windowCenter
        ]);
      });
      // sync translation values in store
      store.set(viewer, "translation", [
        elementId,
        viewport.translation.x,
        viewport.translation.y
      ]);
      // sync scale values in store
      store.set(viewer, "scale", [elementId, viewport.scale]);
      // sync rotation values in store
      store.set(viewer, "rotation", [elementId, viewport.rotation]);
    }
    function mouseUpHandler() {
      document.removeEventListener("mousemove", mouseMoveHandler);
      document.removeEventListener("mouseup", mouseUpHandler);
    }
    document.removeEventListener("mousemove", mouseMoveHandler);
    document.removeEventListener("mouseup", mouseUpHandler);
    document.addEventListener("mousemove", mouseMoveHandler);
    document.addEventListener("mouseup", mouseUpHandler);
  }
  element.addEventListener("mousedown", mouseDownHandler);

  // cornerstoneTools wheel tool listener (update sliceId)
  function mouseWheelHandler(evt) {
    let viewer = store.get("viewer");
    let enabledElement = cornerstone.getEnabledElement(element);
    let cix =
      enabledElement.toolStateManager.toolState.stack.data[0]
        .currentImageIdIndex;
    store.set(viewer, "currentSliceNumber", [evt.target.id, cix]);
  }
  element.removeEventListener("cornerstonetoolsmousewheel", mouseWheelHandler);
  element.addEventListener("cornerstonetoolsmousewheel", mouseWheelHandler);
};

/**
 * Store the viewport data into internal storage
 * @instance
 * @function storeViewportData
 * @param {Object} image - The cornerstone image frame
 * @param {String} elementId - The html div id used for rendering
 * @param {Number} imageIndex - The index of the image
 * @param {Number} numberOfSlices - The number of slices of the series
 * @param {Number} rows - The number of rows of the image
 * @param {Number} cols - The number of columns of the image
 * @param {Number} spacing_x - The spacing value for x axis
 * @param {Number} spacing_y - The spacing value for y direction
 * @param {Number} thickness - The thickness value between slices
 * @param {String} viewport - The viewport tag name
 */
export const storeViewportData = function (
  image,
  elementId,
  imageIndex,
  numberOfSlices,
  rows,
  cols,
  spacing_x,
  spacing_y,
  thickness,
  viewport
) {
  let viewer = store.get("viewer");
  store.set(viewer, "dimensions", [elementId, rows, cols]);
  store.set(viewer, "spacing", [elementId, spacing_x, spacing_y]);
  store.set(viewer, "thickness", [elementId, thickness]);
  store.set(viewer, "minPixelValue", [elementId, image.minPixelValue]);
  store.set(viewer, "maxPixelValue", [elementId, image.maxPixelValue]);
  store.set(viewer, "loadingStatus", [elementId, true]);
  store.set(viewer, "minSliceNumber", [elementId, 0]);
  store.set(viewer, "currentSliceNumber", [elementId, imageIndex]);
  store.set(viewer, "maxSliceNumber", [elementId, numberOfSlices]);
  store.set(viewer, "defaultViewport", [
    elementId,
    viewport.scale,
    viewport.translation.x,
    viewport.translation.y,
    viewport.voi.windowWidth,
    viewport.voi.windowCenter
  ]);
  store.set(viewer, "scale", [elementId, viewport.scale]);
  store.set(viewer, "translation", [
    elementId,
    viewport.translation.x,
    viewport.translation.y
  ]);
  store.set(viewer, "contrast", [
    elementId,
    viewport.voi.windowWidth,
    viewport.voi.windowCenter
  ]);
};
</code></pre>
        </article>
      </section>
    </div>

    <br class="clear" />

    <footer>
      Documentation generated by
      <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> using the
      <a href="https://github.com/clenemt/docdash">docdash</a> theme.
    </footer>

    <script>
      prettyPrint();
    </script>
    <script src="scripts/polyfill.js"></script>
    <script src="scripts/linenumber.js"></script>

    <script src="scripts/search.js" defer></script>

    <script src="scripts/collapse.js" defer></script>
  </body>
</html>
